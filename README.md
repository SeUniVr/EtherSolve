<img src="https://github.com/VersusF/EtherSolve/blob/master/Logo/Logo.png" alt="EtherSolve logo" width="128px" height="128px"><br>
# EtherSolve

EtherSolve is a tool for the control-flow graph extraction from Ethereum bytecode. It analyses smart contracts generated by Solidity.

It is part of the paper [EtherSolve: Computing an Accurate Control-Flow Graph from Ethereum Bytecode](https://arxiv.org/pdf/2103.09113.pdf)

There is also a module for vulnerability detection. It currently supports only the *SSTORE after unsafe call*, which is behind the re-entrancy vulnerability.

## Usage

EtherSolve can be used with the prodived JAR.
SolidiFI
Alternatively, you can build the project from the source code using gradle.

### JAR

The simplest way to try EtherSolve is through the provided jar

```bash
Usage: ethersolve [-hV] [--re-entrancy] [-o=<outputFilename>] (-c | -r) (-j | -H | -s | -d) <source>
EtherSolve, build an accurate CFG from Ethereum bytecode
      <source>        Bytecode string or file containing it
  -c, --creation      Parse bytecode as creation code
  -d, --dot           Export a dot-notation file
  -h, --help          Show this help message and exit.
  -H, --html          Export a graphic HTML report. Graphviz is required!
  -j, --json          Export a Json report
  -o, --output=<outputFilename>
                      Output file
  -r, --runtime       Parse bytecode as runtime code
      --re-entrancy   Execute re-entrancy detector and save output
  -s, --svg           Export a graphic SVG image. Graphviz is required!
  -V, --version       Print version information and exit.
```

The source can be both the bytecode or a path to a file containing it.
Specify if the bytecode is creation code (`-c`) or runtime code (`-r`), and the desired output type.

The tool has been tested on Linux x64 with Java 11.0.8. To produce a graphical output (Html or Svg) [Graphviz](https://graphviz.org/) is required.

To run the re-entrancy validator add the `--re-entrancy` option. The tool will create a CSV file containing the detections and their location in the code. Note that the re-entrancy corresponds to a "Store write after unsafe call".

#### Examples

To analise the bytecode of a certain file, the commands may be the following:

```bash
# Generate HTML report for creation-code source file
java -jar EtherSolve.jar -c -H path/to/bytecode/file.evm
```

```bash
# Generate JSON report in "report.json" for creation-code source file
java -jar EtherSolve.jar -c -j -o report.json path/to/bytecode/file.evm
```

```bash
# Generate HTML report in "index.html" for runtime-code source file
java -jar EtherSolve.jar -r -H -o index.html path/to/bytecode/file.evm
```

```bash
# Generate HTML report in "index.html" for creation-code source file with re-entrancy detection analysis
java -jar EtherSolve.jar -c -H -o index.html --re-entrancy path/to/bytecode/file.evm
```

### Gradle

To build and run the project use gradle (minimum supported version: 5.2.1).

EtherSolve is divided into modules. The project structure is the following:
- **Core:** the main procedures to parse the bytecode and build the CFG.
- **Abi:** contains the validation methods used for the paper. It also contains a prototype for an Abi extractor, but it is discontinued.
- **UI:** contains the procedures to represent the CFG with Graphviz and to produce an HTML report for an analysis. Contains also the command line interface and the main class of the JAR.
- **SecurityAnalysis:** contains the security analyser and the dataset tester used for the comparison with [SolidiFI](https://arxiv.org/pdf/2005.11613.pdf) survey.
- **WebApp:** simple SpringBoot server to provide analysis via APIs. Unmantained.

The tasks to run the modules are:
- `bootRun`: Runs the project as a Spring Boot application.
- `runCoreMain`: Run the main class of Core module, which analyses a sample bytecode written in the `Main` class producing a JSON output.
- `runIRExtractor`: Run the extractor to get the intermediate representation used for automatic analysis.
- `runSecurityAnalyser`: Run the main class of Core module, which analyses a sample bytecode.
- `jar`: Builds a JAR for each module. The only one with an entry point is the one of the UI module, which is also the provided one. The output is in `UI/build/libs`

For the full list run `gradle tasks`.

## Dataset

The full repication package used for the paper can be found [here](https://github.com/SeUniVr/EtherSolve_ICPC2021_ReplicationPackage)